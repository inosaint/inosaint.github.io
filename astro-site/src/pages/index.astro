---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

// Get all published writing posts
const internalWritings = await getCollection('writing', ({ data }) => {
  return data.status === 'published';
});

const externalWritings = [
  {
    title: 'Squads as a Growth Engine for Designers',
    description: 'How we used squads to help our designers level up at Jiva',
    url: 'https://medium.com/notes-from-the-fields/how-we-used-squads-to-help-our-designers-level-up-443fcbc52e2f',
    image: 'https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iuV8e1TmjIe0zsr8yQfXyA.jpeg',
    date: new Date('2025-08-18')
  },
  {
    title: 'Redesigning the Sahabat Jiva app',
    description: 'From Field Insights to Better UX for our Sahabat Jivas',
    url: 'https://medium.com/notes-from-the-fields/from-field-insights-to-better-ux-for-our-sahabat-jivas-3056b32ba51f',
    image: 'https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Fnwkn7IeOiYbTxz-n3K7w.jpeg',
    date: new Date('2025-05-15')
  },
  {
    title: 'How a sticker design became an unofficial Mascot',
    description: 'The story of how a last-minute sticker design became a beloved company icon',
    url: 'https://medium.com/notes-from-the-fields/more-than-swag-how-a-last-minute-sticker-became-a-company-icon-42d86246e736',
    image: 'https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nq0RLdn32pPVk-zLPFy-Cw.png',
    date: new Date('2024-11-28')
  },
  {
    title: 'Designing the Akar Design System',
    description: 'Taming the chaos of hypergrowth with a lean approach to building a design system',
    url: 'https://medium.com/notes-from-the-fields/taming-the-chaos-of-hypergrowth-our-lean-approach-to-building-a-design-system-part-1-2adbb24ddef0',
    image: 'https://miro.medium.com/v2/resize:fit:4800/format:webp/1*L1SeHFlgAyu3LkCQXR252g.png',
    date: new Date('2024-10-17')
  },
  {
    title: 'Gamify DesignOps with human connection',
    description: 'A talk about bringing human connection into DesignOps',
    url: 'https://www.youtube.com/watch?v=c__raLe34ZU',
    image: '/sddefault.jpg',
    date: new Date('2023-08-9')
  },
  {
    title: 'How Gojek\'s design & research teams collaborate effectively across borders',
    description: 'Insights on cross-border collaboration',
    url: 'https://www.gojek.io/blog/near-far-wherever-we-are',
    image: 'https://blog.gojek.io/content/images/2020/10/Blog-banners_Design-research-05.jpg',
    date: new Date('2020-09-08')
  }
];

// Combine and sort all writings by date (newest first)
const allWritings = [
  ...internalWritings.map((post) => ({
    title: post.data.title,
    description: post.data.description,
    url: `/writing/${post.slug}/`,
    image: post.data.image,
    imageUrl: post.data.image ? null : 'https://placehold.co/360x200',
    date: new Date(post.data.date),
    isInternal: true
  })),
  ...externalWritings.map((post) => ({
    ...post,
    imageUrl: post.image,
    isInternal: false
  }))
].sort((a, b) => b.date.getTime() - a.date.getTime());

// Get the 2 most recent posts for the home page
const recentWritings = allWritings.slice(0, 2);

// Get all published projects and sort by year (newest first)
const allProjects = await getCollection('projects', ({ data }) => {
  return data.status === 'published';
});
const sortedProjects = allProjects.sort((a, b) => {
  // Extract the starting year from the year string (e.g., "2023-2024" -> 2023)
  const yearA = parseInt(a.data.year.split('-')[0]);
  const yearB = parseInt(b.data.year.split('-')[0]);
  return yearB - yearA;
});

// Get the 2 most recent projects for the home page
const projects = sortedProjects.slice(0, 2);
---

<BaseLayout>
  <!-- Intro Section -->
  <section class="intro">
    <div class="intro-text">
      <h1>Kenneth Mark Dsouza</h1>
      <h3>
        Product Design Manager with experience building and leading design teams in India and Indonesia.
      </h3>
      <p>
        Recently, I was a senior design manager at <a href="https://www.jiva.ag" target="_blank" rel="noopener noreferrer">Jiva<span class="sr-only"> (opens in new tab)</span></a> (2022-2025), an Agritech startup, where I built and led the product design and research team, working on a suite of mobile apps and web apps for users in rural Indonesia. You can read about the work we did in our Medium publication, <a href="https://medium.com/notes-from-the-fields" target="_blank" rel="noopener noreferrer">Notes from the Fields<span class="sr-only"> (opens in new tab)</span></a>.
      </p>
      <p>
        Prior to this, I worked at <a href="https://www.gojek.com/en-id/" target="_blank" rel="noopener noreferrer">Gojek<span class="sr-only"> (opens in new tab)</span></a> managing a team of designers on the Merchant Platform aka <a href="https://gobiz.co.id/" target="_blank" rel="noopener noreferrer">GoBiz<span class="sr-only"> (opens in new tab)</span></a> and at <a href="https://www.practo.com/providers" target="_blank" rel="noopener noreferrer">Practo<span class="sr-only"> (opens in new tab)</span></a>, an Indian healthcare startup, working on their doctor facing products like <a href="https://www.practo.com/practo-pro-app" target="_blank" rel="noopener noreferrer">Practo Pro<span class="sr-only"> (opens in new tab)</span></a>.
      </p>
    </div>
    <div>
      <img
        src="/profile.png"
        alt="Kenneth Mark Dsouza"
        class="profile-photo"
      />
    </div>
  </section>

  <!-- Projects Section -->
  <section>
    <div class="section-header">
      <h4>Projects</h4>
      <a href="/projects" class="view-all">view all projects →</a>
    </div>
    <div class="grid">
      {projects.map(project => (
        <a href={`/projects/${project.slug}`} class="card">
          {project.data.image ? (
            <Image
              src={project.data.image}
              alt={project.data.title}
              class="card-image"
              width={360}
              height={200}
              densities={[1.5, 2]}
            />
          ) : (
            <img
              src="https://placehold.co/360x200"
              alt={project.data.title}
              class="card-image"
            />
          )}
          <h3>{project.data.title}</h3>
          <p>{project.data.description}</p>
        </a>
      ))}
    </div>
  </section>

  <!-- Writing and Talks Section -->
  <section>
    <div class="section-header">
      <h4>Writing and Talks</h4>
      <a href="/writing" class="view-all">view all writings →</a>
    </div>
    <div class="grid">
      {recentWritings.map(writing => (
        <a href={writing.url} target={writing.isInternal ? undefined : "_blank"} rel={writing.isInternal ? undefined : "noopener noreferrer"} class="card">
          {writing.image && writing.isInternal ? (
            <Image
              src={writing.image}
              alt={writing.title}
              class="card-image"
              width={360}
              height={200}
              densities={[1.5, 2]}
            />
          ) : (
            <img
              src={writing.imageUrl}
              alt={writing.title}
              class="card-image"
            />
          )}
          <h3>
            {writing.title}
            {!writing.isInternal && <span class="sr-only"> (opens in new tab)</span>}
          </h3>
          <p>{writing.description}</p>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>
