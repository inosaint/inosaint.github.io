---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

// Get all published work and sort by year (newest first)
const allWork = await getCollection('work', ({ data }) => {
  return data.status === 'published';
});
const work = allWork.sort((a, b) => {
  // Extract the starting year from the year string (e.g., "2023-2024" -> 2023)
  const yearA = parseInt(a.data.year.split('-')[0]);
  const yearB = parseInt(b.data.year.split('-')[0]);
  return yearB - yearA;
});
---

<BaseLayout title="Work - Kenneth Mark Dsouza">
  <nav class="breadcrumb-header">
    <div class="breadcrumb">
      <a href="/" class="breadcrumb-link">Home</a>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-current">Work</span>
    </div>
  </nav>

  <h1 style="margin-bottom: 3rem;">Work</h1>

  <div class="grid">
    {work.map(item => (
      <a href={`/work/${item.slug}`} class="card">
        {item.data.image ? (
          <Image
            src={item.data.image}
            alt={item.data.title}
            class="card-image"
            width={450}
            height={250}
            densities={[1.5, 2]}
          />
        ) : (
          <img
            src="https://placehold.co/450x250"
            alt={item.data.title}
            class="card-image"
            width="450"
            height="250"
          />
        )}
        <h3>{item.data.title}</h3>
        <p>{item.data.description}</p>
      </a>
    ))}
  </div>
</BaseLayout>
